<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARSI GATE | Remote Control</title>
    <style>
        body { font-family: 'Inter', sans-serif; background: #000; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .gate-card { background: #111; padding: 2.5rem; border-radius: 30px; text-align: center; border: 2px solid #333; width: 85%; max-width: 350px; }
        .unlock-btn { width: 150px; height: 150px; border-radius: 50%; border: none; background: #ef4444; color: white; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 0 20px rgba(239, 68, 68, 0.4); transition: 0.3s; margin: 20px 0; }
        .unlock-btn.active { background: #22c55e; box-shadow: 0 0 30px rgba(34, 197, 94, 0.6); transform: scale(0.95); }
        .status-text { margin-top: 10px; font-size: 0.9rem; color: #666; }
        .member-info { font-size: 0.8rem; color: #4ade80; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>

<div class="gate-card">
    <div id="member-display" class="member-info">Verifying Access...</div>
    <button id="gateBtn" class="unlock-btn" onclick="triggerGate()">PRESS TO<br>UNLOCK</button>
    <div id="status" class="status-text">Standby Mode</div>
</div>

<script>
    // 1. GRAB DATA FROM URL (The stuff passed from your Flask Login)
    const urlParams = new URLSearchParams(window.location.search);
    const memberId = urlParams.get('member_id');
    const secretToken = urlParams.get('secret_token'); // This is your '1234'

    // 2. CHECK IF DATA EXISTS
    if (!memberId || !secretToken) {
        document.getElementById('member-display').innerHTML = "SECURITY ERROR: NO TOKEN";
        document.getElementById('member-display').style.color = "red";
        document.getElementById('gateBtn').disabled = true;
        document.getElementById('gateBtn').style.background = "#333";
    } else {
        document.getElementById('member-display').innerHTML = "MEMBER ID: " + memberId + " | AUTH SYNCED";
    }

    // 3. TRIGGER THE GATE
    function triggerGate() {
        const btn = document.getElementById('gateBtn');
        const status = document.getElementById('status');
        
        btn.classList.add('active');
        btn.innerHTML = "OPENING...";
        status.innerHTML = "Sending signal to Gym Server...";

        // Replace 'YOUR_LOCAL_IP' with the actual IP of your Gym Computer
        // For example: http://192.168.1.5:5000/api/mobile-qr-check-in
        fetch('http://localhost:5000/api/mobile-qr-check-in', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                member_id: memberId,
                secret_token: secretToken
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'granted') {
                status.innerHTML = "ACCESS GRANTED!";
                setTimeout(() => {
                    btn.classList.remove('active');
                    btn.innerHTML = "PRESS TO<br>UNLOCK";
                    status.innerHTML = "Standby Mode";
                }, 3000);
            } else {
                alert("Denied: " + data.message);
                resetBtn();
            }
        })
        .catch(error => {
            alert("Connection Error! Is the Gym PC Server running?");
            resetBtn();
        });
    }

    function resetBtn() {
        const btn = document.getElementById('gateBtn');
        btn.classList.remove('active');
        btn.innerHTML = "PRESS TO<br>UNLOCK";
        document.getElementById('status').innerHTML = "Connection Failed";
    }
</script>

</body>
</html>
