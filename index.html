<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arsi Gym Entry</title>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
    margin:0;
    background:#0f0f0f;
    color:white;
    font-family:Arial, sans-serif;
    text-align:center;
}

.container{
    padding:20px;
}

h1{
    color:#00ff99;
}

#reader{
    margin-top:20px;
}

.result{
    margin-top:25px;
    font-size:24px;
    font-weight:bold;
}

.granted{
    color:#00ff99;
}

.denied{
    color:#ff3b3b;
}
</style>
</head>

<body>

<div class="container">

<h1>ARSI FITNESS GYM</h1>
<p>Scan Wall QR â†’ Then Member QR</p>

<div id="reader"></div>
<div id="result" class="result"></div>

</div>

<script>

// ðŸ”´ REPLACE THIS WITH YOUR RENDER BACKEND URL
const API = "https://YOUR-RENDER-APP.onrender.com/api/mobile-qr-check-in";

let wallVerified = false;

function showMessage(message, type){

    const resultBox = document.getElementById("result");
    resultBox.className = "result " + type;
    resultBox.innerText = message;

    setTimeout(()=>{
        resultBox.innerText="";
        wallVerified=false;
    },3000);
}

function onScanSuccess(decodedText){

    console.log("Scanned:", decodedText);

    // STEP 1: WALL QR
    if(!wallVerified){

        if(decodedText === "1234"){
            wallVerified = true;
            showMessage("Wall Verified âœ… Now Scan Member QR", "granted");
        }else{
            showMessage("Invalid Wall QR âŒ", "denied");
        }
        return;
    }

    // STEP 2: SEND MEMBER TOKEN TO FLASK
    fetch(API,{
        method:"POST",
        headers:{
            "Content-Type":"application/json"
        },
        body:JSON.stringify({
            wall_code:"1234",
            qr_token:decodedText
        })
    })
    .then(response=>{
        if(!response.ok){
            throw new Error("Server response not OK");
        }
        return response.json();
    })
    .then(data=>{
        console.log("Server:", data);

        if(data.status==="granted"){
            showMessage("ACCESS GRANTED âœ…", "granted");
        }else{
            showMessage("ACCESS DENIED âŒ", "denied");
        }

        wallVerified=false;
    })
    .catch(error=>{
        console.log("Fetch Error:", error);
        showMessage("SERVER ERROR âŒ", "denied");
        wallVerified=false;
    });
}

const scanner = new Html5Qrcode("reader");

scanner.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    onScanSuccess
).catch(err=>{
    console.log("Camera Error:", err);
});

</script>

</body>
</html>
